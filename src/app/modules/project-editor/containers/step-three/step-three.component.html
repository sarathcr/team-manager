<ng-template #loaded>
  <div class="project-editor__form step-three">
    <app-status [status]='step.state'></app-status>
    <div class="project-form d-flex flex-column justify-content-between">
      <div>
        <h1 class="project-form__title title_s">
          <span class="project-form__title-number">3.</span>{{'OBJECTIVES.project_objectives_title' | translate}}
          <app-info-tooltip></app-info-tooltip>
        </h1>
        <p class="project-form__description">{{'OBJECTIVES.project_objectives_description'  | translate}}</p>
        <app-step-unlock *ngIf="!(editor.project$|async)?.subjects?.length; else hasSubjects"
          [StepThree]="{step:'stepThree'}"></app-step-unlock>
        <ng-template #hasSubjects>
          <div class="project-editor__subject-wrapper">
            <app-details-selector
              *ngFor="let subject of project?.subjects; let i = index; let last = last;"
              [unselectedLabel]="'OBJECTIVES.project_objectives_criteria_placeholder'"
              [selectedLabel]="'OBJECTIVES.project_objectives_criterion'"
              [subject]="subject"
              [subjectItem]="subject.evaluationCriteria"
              [isLast]="last"
              (deleteById)="openModal($event)"
              [project$]="editor.project$"
              (add)="openModalWithComponent($event)"
              icon="add"
              [loading]="criteriaLoader"
            ></app-details-selector>
            <div class="project-editor__goto-step">
              {{'OBJECTIVES.project_objectivies_add_more_subjects.one' | translate}}
              <span class="project-editor__point" [routerLink]="'stepOne'">
                {{'OBJECTIVES.project_objectivies_add_more_subjects.two' | translate}}
              </span>
              {{'OBJECTIVES.project_objectivies_add_more_subjects.three' | translate}}
            </div>
          </div>
          <div class="project-editor__transevaluation">
            <h2 class="title_xs project-editor__title">
              {{'OBJECTIVES.project_objectives_objectives_subtitle.subtitle' | translate}}
            </h2>
            <p class="project-form__sub-description mb-5">
              {{'OBJECTIVES.project_objectives_objectives_subtitle.description' | translate}}
            </p>
            <app-textarea
            variant='number'
            [maxLength]="150"
            [placeholder]="'OBJECTIVES.project_objectives_objectives_placeholder' | translate"
            [value$]="competencyObjectives$"
            (inputChange)="textAreaUpdate($event)" 
          ></app-textarea>
          </div>
        </ng-template>
      </div>
      <app-button
        [disabled]='buttonConfig.disabled || !project.subjects?.length'
        [theme]="buttonConfig.submitted ? 'success':'primary'"
        [icon]="'tick'"
        (click)='handleSubmit("DONE")'>
        {{ (buttonConfig.submitted ? buttonConfig.successLabel : buttonConfig.label) | translate }}
      </app-button>
    </div>
  </div>
</ng-template>
<app-loader *ngIf="loading; else loaded"></app-loader>

<ng-template #modalDelete>
  <app-modal-info
    [variant]="'delete'"
    [title]="'OBJECTIVES.project_objectives_delete_confirmation_title'"
    [description]="'OBJECTIVES.project_objectives_delete_confirmation_message_nonrelated'"
    [confirmLabel]="'PROJECT.project_button_delete'"
    (decline)="declineModal()"
    (confirm)="confirmModal()"
  ></app-modal-info>
</ng-template>